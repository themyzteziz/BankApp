@page "/History"
@inject BankApp.Interfaces.IAccountService AccountService
@using BankApp.Domain
@using BankApp.Interfaces

<h3>Historik</h3>

@if (accounts == null || accounts.Count == 0)
{
    <p>Inga konton hittades. Skapa ett konto först!</p>
}
else
{
    <ul class="list-group">
        @foreach (var acc in accounts)
        {
            <li class="list-group-item">
                <div>
                    <strong>@acc.Name</strong> — @acc.AccountType<br />
                    Saldo: @acc.Balance @acc.Currency<br />
                    <small>Senast uppdaterad: @acc.LastUpdated.ToLocalTime()</small>
                </div>

                <h5 class="mt-3">Transaktioner:</h5>

                @if (acc.Transactions == null || acc.Transactions.Count == 0)
                {
                    <small>Inga överföring hittades för detta konto.</small>
                }
                else
                {
                    <ul class="list-group list-group-flush">
                        @foreach (var tx in acc.Transactions)
                        {
                            <li class="list-group-item">
                                <div>
                                    <strong>@tx.Date.ToLocalTime():</strong>
                                    @tx.Amount @tx.Currency
                                    <span class="text-muted">(@tx.Type)</span>
                                </div>
                                <div>
                                    <small>@tx.Description</small>
                                </div>
                                <div>
                                    <small>Saldo efter överföring: @acc.Balance</small>
                                </div>
                            </li>
                        }
                    </ul>
                }
            </li>
        }
    </ul>
}

@code {
    private List<IBankAccount> accounts = new();

    protected override async Task OnInitializedAsync()
    {
        accounts = await AccountService.GetAllAccounts();
    }
}
